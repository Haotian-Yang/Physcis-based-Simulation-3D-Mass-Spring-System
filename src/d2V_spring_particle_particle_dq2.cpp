#include <d2V_spring_particle_particle_dq2.h>
#include <iostream>

void d2V_spring_particle_particle_dq2(Eigen::Ref<Eigen::Matrix66d> H, Eigen::Ref<const Eigen::Vector3d> q0,  Eigen::Ref<const Eigen::Vector3d> q1, double l0, double stiffness) {

    // Test for different output from equation
    // Both works
    //Eigen::Matrix66d test;
    //test(0,0) = -stiffness*(-pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0)+l0*(q0(1)*q0(1))+l0*(q0(2)*q0(2))+l0*(q1(1)*q1(1))+l0*(q1(2)*q1(2))-l0*q0(1)*q1(1)*2.0-l0*q0(2)*q1(2)*2.0)*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(0,1) = stiffness*l0*(q0(0)-q1(0))*(q0(1)-q1(1))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(0,2) = stiffness*l0*(q0(0)-q1(0))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(0,3) = stiffness*(-pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0)+l0*(q0(1)*q0(1))+l0*(q0(2)*q0(2))+l0*(q1(1)*q1(1))+l0*(q1(2)*q1(2))-l0*q0(1)*q1(1)*2.0-l0*q0(2)*q1(2)*2.0)*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(0,4) = -stiffness*l0*(q0(0)-q1(0))*(q0(1)-q1(1))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(0,5) = -stiffness*l0*(q0(0)-q1(0))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(1,0) = stiffness*l0*(q0(0)-q1(0))*(q0(1)-q1(1))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(1,1) = -stiffness*(-pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0)+l0*(q0(0)*q0(0))+l0*(q0(2)*q0(2))+l0*(q1(0)*q1(0))+l0*(q1(2)*q1(2))-l0*q0(0)*q1(0)*2.0-l0*q0(2)*q1(2)*2.0)*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(1,2) = stiffness*l0*(q0(1)-q1(1))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(1,3) = -stiffness*l0*(q0(0)-q1(0))*(q0(1)-q1(1))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(1,4) = stiffness*(-pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0)+l0*(q0(0)*q0(0))+l0*(q0(2)*q0(2))+l0*(q1(0)*q1(0))+l0*(q1(2)*q1(2))-l0*q0(0)*q1(0)*2.0-l0*q0(2)*q1(2)*2.0)*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(1,5) = -stiffness*l0*(q0(1)-q1(1))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(2,0) = stiffness*l0*(q0(0)-q1(0))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(2,1) = stiffness*l0*(q0(1)-q1(1))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(2,2) = -stiffness*(-pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0)+l0*(q0(0)*q0(0))+l0*(q0(1)*q0(1))+l0*(q1(0)*q1(0))+l0*(q1(1)*q1(1))-l0*q0(0)*q1(0)*2.0-l0*q0(1)*q1(1)*2.0)*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(2,3) = -stiffness*l0*(q0(0)-q1(0))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(2,4) = -stiffness*l0*(q0(1)-q1(1))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(2,5) = stiffness*(-pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0)+l0*(q0(0)*q0(0))+l0*(q0(1)*q0(1))+l0*(q1(0)*q1(0))+l0*(q1(1)*q1(1))-l0*q0(0)*q1(0)*2.0-l0*q0(1)*q1(1)*2.0)*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(3,0) = stiffness*(-pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0)+l0*(q0(1)*q0(1))+l0*(q0(2)*q0(2))+l0*(q1(1)*q1(1))+l0*(q1(2)*q1(2))-l0*q0(1)*q1(1)*2.0-l0*q0(2)*q1(2)*2.0)*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(3,1) = -stiffness*l0*(q0(0)-q1(0))*(q0(1)-q1(1))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(3,2) = -stiffness*l0*(q0(0)-q1(0))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(3,3) = -stiffness*(-pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0)+l0*(q0(1)*q0(1))+l0*(q0(2)*q0(2))+l0*(q1(1)*q1(1))+l0*(q1(2)*q1(2))-l0*q0(1)*q1(1)*2.0-l0*q0(2)*q1(2)*2.0)*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(3,4) = stiffness*l0*(q0(0)-q1(0))*(q0(1)-q1(1))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(3,5) = stiffness*l0*(q0(0)-q1(0))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(4,0) = -stiffness*l0*(q0(0)-q1(0))*(q0(1)-q1(1))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(4,1) = stiffness*(-pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0)+l0*(q0(0)*q0(0))+l0*(q0(2)*q0(2))+l0*(q1(0)*q1(0))+l0*(q1(2)*q1(2))-l0*q0(0)*q1(0)*2.0-l0*q0(2)*q1(2)*2.0)*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(4,2) = -stiffness*l0*(q0(1)-q1(1))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(4,3) = stiffness*l0*(q0(0)-q1(0))*(q0(1)-q1(1))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(4,4) = -stiffness*(-pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0)+l0*(q0(0)*q0(0))+l0*(q0(2)*q0(2))+l0*(q1(0)*q1(0))+l0*(q1(2)*q1(2))-l0*q0(0)*q1(0)*2.0-l0*q0(2)*q1(2)*2.0)*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(4,5) = stiffness*l0*(q0(1)-q1(1))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(5,0) = -stiffness*l0*(q0(0)-q1(0))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(5,1) = -stiffness*l0*(q0(1)-q1(1))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(5,2) = stiffness*(-pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0)+l0*(q0(0)*q0(0))+l0*(q0(1)*q0(1))+l0*(q1(0)*q1(0))+l0*(q1(1)*q1(1))-l0*q0(0)*q1(0)*2.0-l0*q0(1)*q1(1)*2.0)*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(5,3) = stiffness*l0*(q0(0)-q1(0))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(5,4) = stiffness*l0*(q0(1)-q1(1))*(q0(2)-q1(2))*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);
    //test(5,5) = -stiffness*(-pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0)+l0*(q0(0)*q0(0))+l0*(q0(1)*q0(1))+l0*(q1(0)*q1(0))+l0*(q1(1)*q1(1))-l0*q0(0)*q1(0)*2.0-l0*q0(1)*q1(1)*2.0)*1.0/pow(q0(0)*q1(0)*-2.0-q0(1)*q1(1)*2.0-q0(2)*q1(2)*2.0+q0(0)*q0(0)+q0(1)*q0(1)+q0(2)*q0(2)+q1(0)*q1(0)+q1(1)*q1(1)+q1(2)*q1(2),3.0/2.0);

    H(0,0) = -stiffness*pow(((q0(0)-q1(0))/fabs(q0(0)-q1(0))),2.0)*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0)*(l0*pow(fabs(q0(1)-q1(1)),2.0)+l0*pow(fabs(q0(2)-q1(2)),2.0)-pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0));
    H(0,1) = stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(1)-q1(1))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(0,2) = stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(2)-q1(2))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(0,3) = stiffness*pow(((q0(0)-q1(0))/fabs(q0(0)-q1(0))),2.0)*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0)*(l0*pow(fabs(q0(1)-q1(1)),2.0)+l0*pow(fabs(q0(2)-q1(2)),2.0)-pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0));
    H(0,4) = -stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(1)-q1(1))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(0,5) = -stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(2)-q1(2))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(1,0) = stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(1)-q1(1))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(1,1) = -stiffness*pow(((q0(1)-q1(1))/fabs(q0(1)-q1(1))),2.0)*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0)*(l0*pow(fabs(q0(0)-q1(0)),2.0)+l0*pow(fabs(q0(2)-q1(2)),2.0)-pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0));
    H(1,2) = stiffness*l0*fabs(q0(1)-q1(1))*fabs(q0(2)-q1(2))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(1,3) = -stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(1)-q1(1))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(1,4) = stiffness*pow(((q0(1)-q1(1))/fabs(q0(1)-q1(1))),2.0)*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0)*(l0*pow(fabs(q0(0)-q1(0)),2.0)+l0*pow(fabs(q0(2)-q1(2)),2.0)-pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0));
    H(1,5) = -stiffness*l0*fabs(q0(1)-q1(1))*fabs(q0(2)-q1(2))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(2,0) = stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(2)-q1(2))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(2,1) = stiffness*l0*fabs(q0(1)-q1(1))*fabs(q0(2)-q1(2))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(2,2) = -stiffness*pow(((q0(2)-q1(2))/fabs(q0(2)-q1(2))),2.0)*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0)*(l0*pow(fabs(q0(0)-q1(0)),2.0)+l0*pow(fabs(q0(1)-q1(1)),2.0)-pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0));
    H(2,3) = -stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(2)-q1(2))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(2,4) = -stiffness*l0*fabs(q0(1)-q1(1))*fabs(q0(2)-q1(2))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(2,5) = stiffness*pow(((q0(2)-q1(2))/fabs(q0(2)-q1(2))),2.0)*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0)*(l0*pow(fabs(q0(0)-q1(0)),2.0)+l0*pow(fabs(q0(1)-q1(1)),2.0)-pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0));
    H(3,0) = stiffness*pow(((q0(0)-q1(0))/fabs(q0(0)-q1(0))),2.0)*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0)*(l0*pow(fabs(q0(1)-q1(1)),2.0)+l0*pow(fabs(q0(2)-q1(2)),2.0)-pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0));
    H(3,1) = -stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(1)-q1(1))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(3,2) = -stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(2)-q1(2))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(3,3) = -stiffness*pow(((q0(0)-q1(0))/fabs(q0(0)-q1(0))),2.0)*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0)*(l0*pow(fabs(q0(1)-q1(1)),2.0)+l0*pow(fabs(q0(2)-q1(2)),2.0)-pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0));
    H(3,4) = stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(1)-q1(1))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(3,5) = stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(2)-q1(2))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(4,0) = -stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(1)-q1(1))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(4,1) = stiffness*pow(((q0(1)-q1(1))/fabs(q0(1)-q1(1))),2.0)*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0)*(l0*pow(fabs(q0(0)-q1(0)),2.0)+l0*pow(fabs(q0(2)-q1(2)),2.0)-pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0));
    H(4,2) = -stiffness*l0*fabs(q0(1)-q1(1))*fabs(q0(2)-q1(2))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(4,3) = stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(1)-q1(1))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(4,4) = -stiffness*pow(((q0(1)-q1(1))/fabs(q0(1)-q1(1))),2.0)*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0)*(l0*pow(fabs(q0(0)-q1(0)),2.0)+l0*pow(fabs(q0(2)-q1(2)),2.0)-pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0));
    H(4,5) = stiffness*l0*fabs(q0(1)-q1(1))*fabs(q0(2)-q1(2))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(5,0) = -stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(2)-q1(2))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(5,1) = -stiffness*l0*fabs(q0(1)-q1(1))*fabs(q0(2)-q1(2))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(5,2) = stiffness*pow(((q0(2)-q1(2))/fabs(q0(2)-q1(2))),2.0)*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0)*(l0*pow(fabs(q0(0)-q1(0)),2.0)+l0*pow(fabs(q0(1)-q1(1)),2.0)-pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0));
    H(5,3) = stiffness*l0*fabs(q0(0)-q1(0))*fabs(q0(2)-q1(2))*(((q0(0)-q1(0))/fabs(q0(0)-q1(0))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(5,4) = stiffness*l0*fabs(q0(1)-q1(1))*fabs(q0(2)-q1(2))*(((q0(1)-q1(1))/fabs(q0(1)-q1(1))))*(((q0(2)-q1(2))/fabs(q0(2)-q1(2))))*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0);
    H(5,5) = -stiffness*pow(((q0(2)-q1(2))/fabs(q0(2)-q1(2))),2.0)*1.0/pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0)*(l0*pow(fabs(q0(0)-q1(0)),2.0)+l0*pow(fabs(q0(1)-q1(1)),2.0)-pow(pow(fabs(q0(0)-q1(0)),2.0)+pow(fabs(q0(1)-q1(1)),2.0)+pow(fabs(q0(2)-q1(2)),2.0),3.0/2.0));

    //std::cout << "test: \n" << test << std::endl;
    //std::cout << "H: \n" << H << std::endl;

}
